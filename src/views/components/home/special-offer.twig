{# ============================================================
   Special Offer — 3 layout styles + ⭐ Advanced Coupon (v3)
   Layouts: banner, split, inline
   Fields: component.layout, .title, .description, .image,
           .end_date, .btn_text, .btn_url,
           .coupon_code, .coupon_style, .coupon_reveal, .coupon_ribbon
   ============================================================ #}

{% set offer_layout = component.layout|default('banner') %}
{% set _pt = component.section_padding_top is defined and component.section_padding_top != '' ? component.section_padding_top : null %}
{% set _pb = component.section_padding_bottom is defined and component.section_padding_bottom != '' ? component.section_padding_bottom : null %}
{% set _spacing_style = (_pt is not null or _pb is not null) ? 'style="' ~ (_pt is not null ? 'padding-top:' ~ _pt ~ 'px;' : '') ~ (_pb is not null ? 'padding-bottom:' ~ _pb ~ 'px;' : '') ~ '"' : '' %}

{# ⭐ Coupon macro — renders copyable coupon box #}
{% macro coupon(component) %}
    {% if component.coupon_code %}
        {% set cstyle = component.coupon_style|default('classic') %}
        {% set reveal = component.coupon_reveal is defined and component.coupon_reveal %}
        <div class="najd-coupon najd-coupon--{{ cstyle }} {{ reveal ? 'najd-coupon--reveal' : '' }}"
             data-coupon="{{ component.coupon_code }}">
            {% if component.coupon_ribbon %}
                <span class="najd-coupon__ribbon">{{ component.coupon_ribbon }}</span>
            {% endif %}
            <span class="najd-coupon__label">كود الخصم</span>
            <div class="najd-coupon__code-wrap">
                <span class="najd-coupon__code">{{ component.coupon_code }}</span>
                <button class="najd-coupon__copy" type="button" aria-label="نسخ الكود">
                    <svg class="najd-coupon__icon-copy" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    <svg class="najd-coupon__icon-check" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                </button>
            </div>
            {% if reveal %}
                <p class="najd-coupon__reveal-hint text-xs opacity-60 mt-1">اضغط لكشف الكود</p>
            {% endif %}
        </div>
    {% endif %}
{% endmacro %}

{# Countdown macro #}
{% macro countdown(component) %}
    {% if component.end_date %}
        <div class="najd-countdown" data-end-date="{{ component.end_date }}">
            <div class="najd-countdown__item">
                <span class="najd-countdown__num" data-days>00</span>
                <span class="najd-countdown__label">{{ trans('common.elements.day') }}</span>
            </div>
            <div class="najd-countdown__item">
                <span class="najd-countdown__num" data-hours>00</span>
                <span class="najd-countdown__label">{{ trans('common.elements.hour') }}</span>
            </div>
            <div class="najd-countdown__item">
                <span class="najd-countdown__num" data-minutes>00</span>
                <span class="najd-countdown__label">{{ trans('common.elements.minute') }}</span>
            </div>
            <div class="najd-countdown__item">
                <span class="najd-countdown__num" data-seconds>00</span>
                <span class="najd-countdown__label">{{ trans('common.elements.second') }}</span>
            </div>
        </div>
    {% endif %}
{% endmacro %}

{% if offer_layout == 'split' %}
    {# === Split: image left, countdown + text right === #}
    <section class="najd-block najd-block--offer {{ component.full_width is defined and component.full_width ? '' : 'container' }}" {{ _spacing_style }}>
        <div class="najd-offer-split">
            {% if component.image %}
                <div class="najd-offer-split__image">
                    <img src="{{ component.image }}" alt="{{ component.title }}" loading="lazy">
                </div>
            {% endif %}
            <div class="najd-offer-split__content">
                {% if component.title %}
                    <h2 class="text-2xl lg:text-3xl font-bold mb-3">{{ component.title }}</h2>
                {% endif %}
                {% if component.description %}
                    <p class="text-sm opacity-70 mb-6">{{ component.description }}</p>
                {% endif %}
                {{ _self.countdown(component) }}
                {{ _self.coupon(component) }}
                {% if component.btn_text and component.btn_url %}
                    <a href="{{ component.btn_url }}" class="najd-btn najd-btn--primary mt-6">{{ component.btn_text }}</a>
                {% endif %}
            </div>
        </div>
    </section>

{% elseif offer_layout == 'inline' %}
    {# === Inline: thin horizontal bar === #}
    <section class="najd-block najd-block--offer" {{ _spacing_style }}>
        <div class="najd-offer-inline">
            <div class="{{ component.full_width is defined and component.full_width ? '' : 'container' }}">
                <div class="najd-offer-inline__inner">
                    {% if component.title %}
                        <strong class="najd-offer-inline__title">{{ component.title }}</strong>
                    {% endif %}
                    {{ _self.countdown(component) }}
                    {{ _self.coupon(component) }}
                    {% if component.btn_text and component.btn_url %}
                        <a href="{{ component.btn_url }}" class="najd-btn najd-btn--primary najd-btn--sm">{{ component.btn_text }}</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

{% else %}
    {# === Banner (default): full-width with background image === #}
    <section class="najd-block najd-block--offer" {{ _spacing_style }}>
        <div class="{{ component.full_width is defined and component.full_width ? '' : 'container' }}">
            <div class="najd-offer rounded-lg overflow-hidden">
                {% if component.image %}
                    <div class="najd-offer__bg" style="background-image: url({{ component.image }});"></div>
                {% endif %}
                <div class="najd-offer__content">
                    {% if component.title %}
                        <h2 class="text-2xl lg:text-4xl font-bold mb-3">{{ component.title }}</h2>
                    {% endif %}
                    {% if component.description %}
                        <p class="text-sm opacity-70 mb-6 max-w-md">{{ component.description }}</p>
                    {% endif %}
                    {{ _self.countdown(component) }}
                    {{ _self.coupon(component) }}
                    {% if component.btn_text and component.btn_url %}
                        <a href="{{ component.btn_url }}" class="najd-btn najd-btn--primary mt-6">{{ component.btn_text }}</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
{% endif %}
